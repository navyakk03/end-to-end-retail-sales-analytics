create database retail_analytics;
use retail_analytics;

CREATE TABLE online_retail_clean (
    InvoiceNo VARCHAR(20),
    StockCode VARCHAR(20),
    Description TEXT,
    Quantity INT,
    InvoiceDate DATETIME,
    UnitPrice DECIMAL(10,2),
    CustomerID INT,
    Country VARCHAR(50),
    Revenue DECIMAL(12,2),
    Year INT,
    Month INT,
    Day INT,
    Weekday VARCHAR(15)
);
TRUNCATE TABLE online_retail_clean;
SET GLOBAL local_infile = 1;

SHOW VARIABLES LIKE 'local_infile';

LOAD DATA LOCAL INFILE 'C:/retail/online_retail_clean.csv'
INTO TABLE online_retail_clean
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'
IGNORE 1 ROWS;

SELECT COUNT(*) FROM online_retail_clean;

SELECT * FROM online_retail_clean LIMIT 5;

DESCRIBE online_retail_clean;

SELECT 
    SUM(CASE WHEN InvoiceNo IS NULL THEN 1 ELSE 0 END) AS null_invoice,
    SUM(CASE WHEN CustomerID IS NULL THEN 1 ELSE 0 END) AS null_customer,
    SUM(CASE WHEN Quantity IS NULL THEN 1 ELSE 0 END) AS null_quantity
FROM online_retail_clean;

SELECT 
    SUM(Quantity) AS total_items_sold
FROM online_retail_clean;

SELECT 
    Year,
    Month,
    SUM(Revenue) AS MonthlyRevenue
FROM online_retail_clean
GROUP BY Year, Month
ORDER BY Year, Month;

SELECT 
    Year,
    SUM(Revenue) AS YearlyRevenue
FROM online_retail_clean
GROUP BY Year
ORDER BY Year;

SELECT 
    Country,
    SUM(Revenue) AS TotalRevenue
FROM online_retail_clean
GROUP BY Country
ORDER BY TotalRevenue DESC;

SELECT 
    Country,
    SUM(Revenue) AS TotalRevenue
FROM online_retail_clean
GROUP BY Country
ORDER BY TotalRevenue DESC
LIMIT 5;

SELECT 
    CustomerID,
    SUM(Revenue) AS CustomerRevenue
FROM online_retail_clean
GROUP BY CustomerID
ORDER BY CustomerRevenue DESC
LIMIT 10;

SELECT 
    AVG(CustomerRevenue) AS AvgRevenuePerCustomer
FROM (
    SELECT CustomerID, SUM(Revenue) AS CustomerRevenue
    FROM online_retail_clean
    GROUP BY CustomerID
) t;

SELECT 
    StockCode,
    Description,
    SUM(Quantity) AS TotalQuantity
FROM online_retail_clean
GROUP BY StockCode, Description
ORDER BY TotalQuantity DESC
LIMIT 10;

SELECT 
    StockCode,
    Description,
    SUM(Revenue) AS ProductRevenue
FROM online_retail_clean
GROUP BY StockCode, Description
ORDER BY ProductRevenue DESC
LIMIT 10;

SELECT 
    DATE(InvoiceDate) AS OrderDate,
    SUM(Revenue) AS DailyRevenue
FROM online_retail_clean
GROUP BY OrderDate
ORDER BY OrderDate;

SELECT 
    Month,
    COUNT(DISTINCT InvoiceNo) AS TotalOrders
FROM online_retail_clean
GROUP BY Month
ORDER BY TotalOrders DESC;
